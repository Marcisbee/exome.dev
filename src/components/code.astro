---
interface Props {
	code: string;
	lang?: string;
}

const { code = "", lang = "ts" } = Astro.props;

import {
	renderCodeToHTML,
	runTwoSlash,
	createShikiHighlighter,
} from "shiki-twoslash";

const highlighter = await createShikiHighlighter({ theme: "github-light" });
const twoslash = runTwoSlash(code, lang, {});

const html = renderCodeToHTML(
	twoslash.code,
	lang,
	{ twoslash: true },
	{
		themeName: "github-light",
		includeJSDocInHover: true,
	},
	highlighter,
	twoslash,
);

// import {
//   codeToHtml,
// } from 'shikiji'
// import { rendererRich, rendererClassic, transformerTwoSlash } from 'shikiji-twoslash';
// import "shikiji-twoslash/style-classic.css";
// import "shikiji-twoslash/style-rich.css";

// const html = await codeToHtml(code, {
//   lang: 'typescript',
// 	themes: {
// 		light: 'github-light',
// 		dark: 'github-dark',
// 	},
// 	transformers: [
//     transformerTwoSlash({
// 			explicitTrigger: true,
// 			renderer: rendererClassic(),
// 		}),
// 	],
// })
---

<script>
	class DataLsp extends HTMLElement {
		connectedCallback() {
			if (this.textContent === "Exome") {
				this.innerHTML = `<a href="api-reference#exome">${this.textContent}</a>`;
			}
		}
	}

	customElements.define("data-lsp", DataLsp);
</script>

<Fragment set:html={html} />
